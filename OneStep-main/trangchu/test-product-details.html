<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Chi Tiết Sản Phẩm</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .product-detail { border: 1px solid #ddd; margin: 10px; padding: 15px; border-radius: 8px; }
        .detail-row { display: flex; justify-content: space-between; margin: 5px 0; }
        .detail-label { font-weight: bold; color: #333; }
        .detail-value { color: #007bff; }
        .status-active { color: #28a745; font-weight: bold; }
        .status-inactive { color: #6c757d; }
        .status-paused { color: #ffc107; font-weight: bold; }
        .status-out-of-stock { color: #dc3545; font-weight: bold; }
        .error { color: #e74c3c; background: #fdf2f2; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: #27ae60; background: #f0f9f0; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .loading { color: #3498db; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
        input { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test API Chi Tiết Sản Phẩm</h1>
        
        <div>
            <input type="number" id="productId" placeholder="Nhập ID sản phẩm" value="1">
            <button onclick="testProductDetails()">Test Chi Tiết Sản Phẩm</button>
            <button onclick="testAllProducts()">Test Tất Cả Sản Phẩm</button>
            <button onclick="clearResults()">Xóa kết quả</button>
        </div>
        
        <div id="status"></div>
        <div id="results"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        function showStatus(message, type = 'loading') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${type}">${message}</div>`;
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('status').innerHTML = '';
        }
        
        async function testProductDetails() {
            const productId = document.getElementById('productId').value;
            if (!productId) {
                showStatus('Vui lòng nhập ID sản phẩm', 'error');
                return;
            }
            
            showStatus(`Đang lấy chi tiết sản phẩm cho ID ${productId}...`, 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/chi-tiet-san-pham/hien-thi-theo-san-pham/${productId}`);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus(`✅ Thành công! Lấy được ${data.length} chi tiết sản phẩm cho ID ${productId}`, 'success');
                    displayProductDetails(data, productId);
                } else {
                    showStatus(`❌ Lỗi API: ${response.status} - ${response.statusText}`, 'error');
                }
            } catch (error) {
                showStatus(`❌ Lỗi kết nối: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }
        
        async function testAllProducts() {
            showStatus('Đang lấy tất cả sản phẩm...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/chi-tiet-san-pham/hien-thi`);
                const data = await response.json();
                
                if (response.ok) {
                    showStatus(`✅ Thành công! Lấy được ${data.length} sản phẩm`, 'success');
                    displayAllProducts(data);
                } else {
                    showStatus(`❌ Lỗi API: ${response.status} - ${response.statusText}`, 'error');
                }
            } catch (error) {
                showStatus(`❌ Lỗi kết nối: ${error.message}`, 'error');
                console.error('Error:', error);
            }
        }
        
        function displayProductDetails(details, productId) {
            const resultsDiv = document.getElementById('results');
            
            if (!Array.isArray(details) || details.length === 0) {
                resultsDiv.innerHTML = `<div class="error">Không có chi tiết sản phẩm cho ID ${productId}</div>`;
                return;
            }
            
            let html = `<h2>Chi tiết sản phẩm cho ID ${productId} (${details.length} biến thể)</h2>`;
            
            details.forEach((detail, index) => {
                html += `
                    <div class="product-detail">
                        <h3>Biến thể ${index + 1}</h3>
                        <div class="detail-row">
                            <span class="detail-label">Mã chi tiết:</span>
                            <span class="detail-value">${detail.maChiTiet || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Kích cỡ ID:</span>
                            <span class="detail-value">${detail.kichCoId || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Màu sắc ID:</span>
                            <span class="detail-value">${detail.mauSacId || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Giá tiền:</span>
                            <span class="detail-value">${formatPrice(detail.giaTien || 0)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Tiền giảm giá:</span>
                            <span class="detail-value">${formatPrice(detail.tienGiamGia || 0)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Số lượng tồn:</span>
                            <span class="detail-value">${detail.soLuongTon || 0}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Trạng thái:</span>
                            <span class="detail-value ${getStatusClass(detail.trangThai)}">${getStatusText(detail.trangThai)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Đã xóa:</span>
                            <span class="detail-value">${detail.daXoa ? 'Có' : 'Không'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Ngày cập nhật:</span>
                            <span class="detail-value">${detail.ngayCapNhat || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Người tạo:</span>
                            <span class="detail-value">${detail.nguoiTao || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Người cập nhật:</span>
                            <span class="detail-value">${detail.nguoiCapNhat || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hình ảnh:</span>
                            <span class="detail-value">${detail.duongDanAnh || 'N/A'}</span>
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }
        
        function displayAllProducts(products) {
            const resultsDiv = document.getElementById('results');
            
            if (!Array.isArray(products) || products.length === 0) {
                resultsDiv.innerHTML = `<div class="error">Không có sản phẩm nào</div>`;
                return;
            }
            
            let html = `<h2>Tất cả sản phẩm (${products.length} sản phẩm)</h2>`;
            
            products.slice(0, 5).forEach((product, index) => {
                html += `
                    <div class="product-detail">
                        <h3>Sản phẩm ${index + 1}</h3>
                        <div class="detail-row">
                            <span class="detail-label">Mã chi tiết:</span>
                            <span class="detail-value">${product.maChiTiet || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Sản phẩm ID:</span>
                            <span class="detail-value">${product.sanPhamId || 'N/A'}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Giá tiền:</span>
                            <span class="detail-value">${formatPrice(product.giaTien || 0)}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Số lượng tồn:</span>
                            <span class="detail-value">${product.soLuongTon || 0}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Trạng thái:</span>
                            <span class="detail-value ${getStatusClass(product.trangThai)}">${getStatusText(product.trangThai)}</span>
                        </div>
                    </div>
                `;
            });
            
            if (products.length > 5) {
                html += `<p>... và ${products.length - 5} sản phẩm khác</p>`;
            }
            
            resultsDiv.innerHTML = html;
        }
        
        function getStatusText(status) {
            const statusMap = {
                0: 'Không hoạt động',
                1: 'Hoạt động',
                2: 'Tạm ngưng',
                3: 'Hết hàng'
            };
            return statusMap[status] || 'Không xác định';
        }
        
        function getStatusClass(status) {
            const classMap = {
                0: 'status-inactive',
                1: 'status-active',
                2: 'status-paused',
                3: 'status-out-of-stock'
            };
            return classMap[status] || 'status-inactive';
        }
        
        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }
        
        // Auto test khi load trang
        window.onload = function() {
            showStatus('Trang đã tải xong. Nhấn nút để test API.', 'loading');
        };
    </script>
</body>
</html>
